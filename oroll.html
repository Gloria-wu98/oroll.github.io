<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloriaè€å¸«çš„å°å¸«ç­æ¯é€±å‡ºç¼ºå‹¤é»åè¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªè¨‚ TailwindCSS */
        body {
            font-family: 'Inter', sans-serif; /* ä½¿ç”¨ Inter å­—é«” */
        }
        .subject-select, #formFillerSelect { /* å°‡æ¨£å¼æ‡‰ç”¨åˆ°ä¸‹æ‹‰é¸å–® */
            min-width: 120px;
            padding: 0.25rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background-color: transparent;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%236b7280%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%, 0 0;
            background-size: .65em auto, 100%;
        }
        #formFillerSelect { /* é‡å°å¡«è¡¨äººä¸‹æ‹‰é¸å–®çš„ç‰¹å®šèª¿æ•´ */
            padding: 0.375rem 0.75rem; /* Tailwind p-1.5 */
        }
        /* è‡ªè¨‚çš„ "X" æ¨™è¨˜æ¨£å¼ */
        .custom-checkbox-container {
            width: 2em;
            height: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            cursor: pointer;
            margin: auto;
        }
        .custom-checkbox-container.checked .x-mark {
            display: inline;
            color: #ef4444;
            font-weight: bold;
            font-size: 1.25em;
        }
        .x-mark {
            display: none;
        }

        th, td {
            padding: 0.75rem; /* å„²å­˜æ ¼å…§è· */
            border: 1px solid #e2e8f0; /* å„²å­˜æ ¼é‚Šæ¡† */
            text-align: center;
            white-space: nowrap; /* é˜²æ­¢å„²å­˜æ ¼å…§å®¹æ›è¡Œ */
        }
        th {
            background-color: #f3f4f6; /* è¡¨é ­èƒŒæ™¯è‰² */
            font-weight: 600; /* è¡¨é ­å­—é«”åŠ ç²— */
        }
        tfoot td {
            font-weight: 600; /* è¡¨å°¾å­—é«”åŠ ç²— */
            background-color: #f3f4f6; /* è¡¨å°¾èƒŒæ™¯è‰² */
        }
        .sticky-col {
            position: -webkit-sticky; /* Safari */
            position: sticky; /* æ¨™æº– */
        }
        /* èª¿æ•´é‡˜é¸æ¬„ä½çš„ left offset */
        .sticky-col-date { left: 0; z-index: 10;}
        .sticky-col-period { left: 104px; z-index: 10;} /* ä¼°è¨ˆæ—¥æœŸæ¬„å¯¬åº¦ç´„ 104px */
        .sticky-col-subject { left: 158px; z-index: 10;} /* ä¼°è¨ˆæ—¥æœŸ+ç¯€æ¬¡æ¬„å¯¬åº¦ç´„ 104+54=158px */


        thead th { /* è¡¨é ­é‡˜é¸åœ¨é ‚éƒ¨ */
            position: -webkit-sticky; /* Safari */
            position: sticky; /* æ¨™æº– */
            top: 0;
            background-color: #f3f4f6; /* æ˜ç¢ºè¨­å®šé‡˜é¸è¡¨é ­çš„èƒŒæ™¯è‰² */
            z-index: 20; /* ç¢ºä¿åœ¨å…¶ä»–å…§å®¹ä¹‹ä¸Š */
        }
        /* ç¢ºä¿å·¦å´é‡˜é¸çš„è¡¨é ­å„²å­˜æ ¼ z-index æ›´é«˜ï¼Œä¸”èƒŒæ™¯èˆ‡æ™®é€šè¡¨é ­ä¸€è‡´ */
        thead .sticky-col-date { z-index: 21; background-color: #f3f4f6 !important; } /* z-index ç•¥é«˜æ–¼æ™®é€šè¡¨é ­é‡˜é¸ */
        thead .sticky-col-period { z-index: 21; background-color: #f3f4f6 !important; }
        thead .sticky-col-subject { z-index: 21; background-color: #f3f4f6 !important; }


        .text-red-500 { color: #ef4444; } /* ç´…è‰²æ–‡å­— */
        .bg-sky-200 { background-color: #bae6fd; } /* å¤©è—è‰²èƒŒæ™¯ */
        .bg-pink-200 { background-color: #fbcfe8; } /* ç²‰ç´…è‰²èƒŒæ™¯ */
        .summary-link span { /* è®“æ–‡å­—çœ‹èµ·ä¾†åƒé€£çµ */
            color: #3b82f6; /* Tailwind blue-500 */
            cursor: pointer;
            text-decoration: underline;
        }
        .summary-link span:hover {
            color: #2563eb; /* Tailwind blue-600 */
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-gray-700">Gloriaè€å¸«çš„å°å¸«ç­æ¯é€±å‡ºç¼ºå‹¤é»åè¡¨</h1>
            <p class="text-sm text-gray-600 mt-2 p-2 rounded bg-sky-200 inline-block">è¡¨æ ¼å‰µå»ºäººï¼šGloriaå³ç§€è˜­è€å¸«ï¼ŒGoogleèªè­‰è¬›å¸«ï¼Œè‹±æ–‡å…¼å°èªæ•™å¸«</p>
            <p class="text-sm text-gray-500 mt-3 p-1 rounded bg-pink-200 inline-block font-bold italic">ğŸ™Œè«‹åœ¨ä¸‹æ–¹è¡¨æ ¼æ¨™æ³¨è©²ä½åŒå­¸è©²ç¯€èª²æ› èª²ç‹€æ³ã€‚</p>
            <div class="mt-3 text-sm">
                <label for="formFillerSelect" class="font-medium text-gray-700">å¡«è¡¨äººï¼š</label>
                <select id="formFillerSelect" name="formFillerSelect" class="border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    <option value="å°å¹«æ‰‹">å°å¹«æ‰‹</option>
                    <option value="å°å¸«">å°å¸«</option>
                </select>
            </div>
        </header>

        <div class="mb-6 flex flex-col sm:flex-row items-center sm:space-x-3 bg-white p-4 rounded-lg shadow">
            <label for="weekStart" class="text-sm font-medium text-gray-700 mb-2 sm:mb-0 font-bold">é¸æ“‡é€±ä¸€æ—¥æœŸï¼š</label>
            <input type="date" id="weekStart" class="border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
        </div>

        <div id="tableContainer" class="overflow-x-auto bg-white rounded-lg shadow">
            <table id="attendanceTable" class="min-w-full border-collapse border border-gray-300">
                <thead id="tableHeader" class="bg-gray-100">
                    </thead>
                <tbody id="tableBody">
                    </tbody>
                <tfoot id="tableFooter" class="bg-gray-100 font-semibold">
                    </tfoot>
            </table>
        </div>
         <div id="noDataMessage" class="hidden mt-4 text-center text-gray-500">
            è«‹é¸æ“‡æ—¥æœŸä»¥è¼‰å…¥é»åè¡¨ã€‚
        </div>
    </div>

    <script>
        // å­¸ç”Ÿåå–®
        const students = [
            { seat: "1", id: "219001", name: "æœç­±æ¸" }, { seat: "2", id: "219002", name: "ç‹å®¥é§" },
            { seat: "3", id: "219003", name: "ç‹éŸ‹éˆ" }, { seat: "4", id: "219004", name: "ç‹å°‰ä¸" },
            { seat: "5", id: "219005", name: "ç‹ç¨Ÿç¨‹" }, { seat: "6", id: "219006", name: "æœ±å½¥éœ–" },
            { seat: "7", id: "219007", name: "å³æŸèª¼" }, { seat: "8", id: "219008", name: "æå°šéŒ¤" },
            { seat: "9", id: "219009", name: "æå½¥å»·" }, { seat: "10", id: "219010", name: "æ—æ­£å‹›" },
            { seat: "11", id: "219011", name: "æ—æ¾ä¾‘" }, { seat: "12", id: "219012", name: "æ—å† å»·" },
            { seat: "13", id: "219013", name: "æ—å† ç©" }, { seat: "14", id: "219014", name: "æ—åšå®£" },
            { seat: "15", id: "219015", name: "æ—æ¯…é‘«" }, { seat: "16", id: "219016", name: "é™³ç¿Šå‡±" },
            { seat: "17", id: "219017", name: "èŠæ–‡ç¦¾" }, { seat: "18", id: "219018", name: "éƒ­å®¥è¾°" },
            { seat: "19", id: "219019", name: "éƒ­æŸå²‘" }, { seat: "20", id: "219020", name: "é™³å‹æ–‡" },
            { seat: "21", id: "219021", name: "é™³æ†ç¿Š" }, { seat: "22", id: "219022", name: "é™³æŸå®‡" },
            { seat: "23", id: "219023", name: "é»ƒå† æ¾¤" }, { seat: "24", id: "219024", name: "é»ƒå®¥å˜‰" },
            { seat: "25", id: "219025", name: "å»–æ™‰ä½‘" }, { seat: "26", id: "219026", name: "è¬å°šè«­" },
            { seat: "27", id: "219027", name: "è¬åšå®‰" }, { seat: "29", id: "219029", name: "è˜‡å¥•é½Š" }
        ];
        // ç§‘ç›®åˆ—è¡¨
        const subjects = ["", "åœ‹æ–‡", "è‹±æ–‡", "æ•¸å­¸", "é«”è‚²", "ç¾è¡“", "ç‰©ç†", "å°ˆæ¥­", "å¯¦ç¿’", "å°ˆé¡Œ", "ç­æœƒ", "é€±æœƒ/ç¤¾åœ˜"];
        // å¡«è¡¨äººè§’è‰²
        const roles = ["å°å¹«æ‰‹", "å°å¸«"]; // å®šç¾©è§’è‰²åˆ—è¡¨

        const NUM_PERIODS = 7; // æ¯æ—¥ç¯€æ¬¡æ•¸
        const NUM_DAYS = 5;    // æ¯é€±å¤©æ•¸ (é€±ä¸€è‡³é€±äº”)

        const weekStartInput = document.getElementById('weekStart');
        const tableHeader = document.getElementById('tableHeader');
        const tableBody = document.getElementById('tableBody');
        const tableFooter = document.getElementById('tableFooter');
        const noDataMessage = document.getElementById('noDataMessage');
        const tableContainer = document.getElementById('tableContainer');
        const formFillerSelect = document.getElementById('formFillerSelect');

        // å°‡æ—¥æœŸç‰©ä»¶æ ¼å¼åŒ–ç‚º YYYYMMDD å­—ä¸²
        function formatDateAsYYYYMMDD(dateObj) {
            const year = dateObj.getFullYear();
            const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
            const day = dateObj.getDate().toString().padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // åˆå§‹åŒ–æ—¥æœŸé¸æ“‡å™¨ç‚ºç•¶é€±çš„é€±ä¸€ä¸¦æ¸²æŸ“è¡¨æ ¼
        function initializeDate() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 (é€±æ—¥) - 6 (é€±å…­)
            const diffToMonday = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // è¨ˆç®—åˆ°é€±ä¸€çš„æ—¥æœŸå·®
            const monday = new Date(today.setDate(diffToMonday));
            weekStartInput.valueAsDate = monday;
            renderTable(monday);
        }

        // æ¸²æŸ“æ•´å€‹è¡¨æ ¼
        function renderTable(startDate) {
            if (!startDate || isNaN(startDate.getTime())) {
                 tableContainer.classList.add('hidden');
                 noDataMessage.classList.remove('hidden');
                return;
            }
            tableContainer.classList.remove('hidden');
            noDataMessage.classList.add('hidden');

            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            // è¡¨å°¾çµæ§‹ç”± renderFooterStructure å‰µå»ºï¼Œä¸¦ç”± updateWeeklyAbsenceTotals æ›´æ–°å…§å®¹

            // æ¸²æŸ“è¡¨é ­
            const headerRow = tableHeader.insertRow();
            const dateTh = headerRow.insertCell();
            dateTh.textContent = 'æ—¥æœŸ';
            dateTh.classList.add('sticky-col', 'sticky-col-date');

            const periodTh = headerRow.insertCell();
            periodTh.textContent = 'ç¯€æ¬¡';
            periodTh.classList.add('sticky-col', 'sticky-col-period');

            const subjectTh = headerRow.insertCell();
            subjectTh.textContent = 'ç§‘ç›®';
            subjectTh.classList.add('sticky-col', 'sticky-col-subject');

            students.forEach(student => {
                const studentTh = headerRow.insertCell();
                studentTh.textContent = `${student.seat}. ${student.name}`;
                studentTh.classList.add('px-2', 'py-3', 'text-xs'); // å­¸ç”Ÿå§“åè¡¨é ­æ¨£å¼
            });

            // æ¸²æŸ“è¡¨æ ¼ä¸»é«”
            const selectedRoleForDisplay = formFillerSelect.value; // ç²å–ç•¶å‰é¸æ“‡ä»¥é¡¯ç¤ºçš„è§’è‰²

            for (let dayIndex = 0; dayIndex < NUM_DAYS; dayIndex++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + dayIndex);
                const formattedCellDate = formatDateAsYYYYMMDD(cellDate);
                const dateString = cellDate.toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit' });
                const dayName = cellDate.toLocaleDateString('zh-TW', { weekday: 'short' });

                let rowBgClass = '';
                if (dayIndex === 0 || dayIndex === 2 || dayIndex === 4) { // é€±ä¸€, é€±ä¸‰, é€±äº”
                    rowBgClass = 'bg-yellow-100';
                } else if (dayIndex === 1) { // é€±äºŒ
                    rowBgClass = 'bg-sky-100';
                } else { // é€±å›› (dayIndex === 3)
                    rowBgClass = 'bg-green-100';
                }

                for (let periodIndex = 0; periodIndex < NUM_PERIODS; periodIndex++) {
                    const row = tableBody.insertRow();

                    const dateCell = row.insertCell();
                    dateCell.classList.add(rowBgClass); // å¥—ç”¨æ¯æ—¥èƒŒæ™¯è‰²
                    if (periodIndex === 0) { // æ¯å¤©çš„ç¬¬ä¸€ç¯€èª²é¡¯ç¤ºæ—¥æœŸå’Œæ˜ŸæœŸ
                        dateCell.textContent = `${dateString} (${dayName})`;
                        dateCell.rowSpan = NUM_PERIODS; // åˆä½µå„²å­˜æ ¼
                        dateCell.classList.add('sticky-col', 'sticky-col-date', 'align-middle');
                    } else {
                        dateCell.classList.add('hidden'); // éš±è—å¾ŒçºŒç¯€æ¬¡çš„æ—¥æœŸå„²å­˜æ ¼
                    }

                    const periodCell = row.insertCell();
                    periodCell.textContent = (periodIndex + 1).toString();
                    periodCell.classList.add('sticky-col', 'sticky-col-period', 'align-middle', rowBgClass);

                    const subjectCell = row.insertCell();
                    const subjectSelect = document.createElement('select');
                    subjectSelect.classList.add('subject-select', 'w-full', 'text-sm');
                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        if (subject === "") option.textContent = "é¸æ“‡ç§‘ç›®"; // é è¨­æç¤ºæ–‡å­—
                        subjectSelect.appendChild(option);
                    });
                    subjectCell.appendChild(subjectSelect);
                    subjectCell.classList.add('sticky-col', 'sticky-col-subject', 'align-middle', rowBgClass);

                    students.forEach(student => {
                        const attendanceCell = row.insertCell();
                        attendanceCell.classList.add(rowBgClass); // å¥—ç”¨æ¯æ—¥èƒŒæ™¯è‰²
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.classList.add('custom-checkbox-container');
                        
                        checkboxContainer.dataset.studentId = student.id;
                        checkboxContainer.dataset.date = formattedCellDate;
                        checkboxContainer.dataset.period = periodIndex.toString();

                        // æ ¹æ“šé¸æ“‡çš„è§’è‰²è®€å– localStorage ä»¥é¡¯ç¤º "X"
                        const localStorageKeyForDisplay = `absence_${selectedRoleForDisplay}_${student.id}_${formattedCellDate}_${periodIndex}`;
                        const isChecked = localStorage.getItem(localStorageKeyForDisplay) === "true";
                        
                        checkboxContainer.dataset.checked = isChecked.toString();
                        if(isChecked) checkboxContainer.classList.add('checked');

                        const xMark = document.createElement('span');
                        xMark.classList.add('x-mark');
                        xMark.textContent = 'X';
                        checkboxContainer.appendChild(xMark);

                        checkboxContainer.addEventListener('click', () => {
                            const currentCheckedState = checkboxContainer.dataset.checked === "true";
                            const newCheckedState = !currentCheckedState;
                            checkboxContainer.dataset.checked = newCheckedState.toString();
                            checkboxContainer.classList.toggle('checked', newCheckedState);

                            // å„²å­˜æ™‚ï¼Œä½¿ç”¨ç•¶å‰ä¸‹æ‹‰é¸å–®é¸æ“‡çš„è§’è‰²
                            const roleForStorage = formFillerSelect.value;
                            const key = `absence_${roleForStorage}_${checkboxContainer.dataset.studentId}_${checkboxContainer.dataset.date}_${checkboxContainer.dataset.period}`;
                            if (newCheckedState) {
                                localStorage.setItem(key, "true");
                            } else {
                                localStorage.removeItem(key);
                            }
                            updateWeeklyAbsenceTotals(); // æ›´æ–°ç¸½è¨ˆ
                        });
                        attendanceCell.appendChild(checkboxContainer);
                        attendanceCell.classList.add('align-middle');
                    });
                }
            }
            renderFooterStructure(); // å‰µå»ºè¡¨å°¾çµæ§‹
            updateWeeklyAbsenceTotals(); // è¨ˆç®—ä¸¦æ›´æ–°è¡¨å°¾çµ±è¨ˆ
        }

        // æ›´æ–°æ¯é€±æ› èª²ç¸½è¨ˆ (é‡å°å°å¹«æ‰‹å’Œå°å¸«åˆ†åˆ¥è¨ˆç®—)
        function updateWeeklyAbsenceTotals() {
            const currentWeekStartDate = new Date(weekStartInput.value); 

            students.forEach(student => {
                let assistantWeeklyAbsences = 0;
                let tutorWeeklyAbsences = 0;

                for (let dayOffset = 0; dayOffset < NUM_DAYS; dayOffset++) {
                    const dayDate = new Date(currentWeekStartDate);
                    dayDate.setDate(currentWeekStartDate.getDate() + dayOffset);
                    const formattedDayDate = formatDateAsYYYYMMDD(dayDate);

                    for (let periodIdx = 0; periodIdx < NUM_PERIODS; periodIdx++) {
                        // æª¢æŸ¥ "å°å¹«æ‰‹" çš„æ¨™è¨˜
                        const keyAssistant = `absence_å°å¹«æ‰‹_${student.id}_${formattedDayDate}_${periodIdx}`;
                        if (localStorage.getItem(keyAssistant) === "true") {
                            assistantWeeklyAbsences++;
                        }
                        // æª¢æŸ¥ "å°å¸«" çš„æ¨™è¨˜
                        const keyTutor = `absence_å°å¸«_${student.id}_${formattedDayDate}_${periodIdx}`;
                        if (localStorage.getItem(keyTutor) === "true") {
                            tutorWeeklyAbsences++;
                        }
                    }
                }

                // æ›´æ–°å°å¹«æ‰‹æ¨™è¨˜æ¬¡æ•¸
                const assistantTotalCell = document.getElementById(`assistant-total-cell-${student.id}`);
                if (assistantTotalCell) {
                    assistantTotalCell.textContent = assistantWeeklyAbsences.toString();
                    if (assistantWeeklyAbsences > 0) assistantTotalCell.classList.add('text-red-500');
                    else assistantTotalCell.classList.remove('text-red-500');
                }

                // æ›´æ–°å°å¸«æ¨™è¨˜æ¬¡æ•¸
                const tutorTotalCell = document.getElementById(`tutor-total-cell-${student.id}`);
                if (tutorTotalCell) {
                    tutorTotalCell.textContent = tutorWeeklyAbsences.toString();
                    if (tutorWeeklyAbsences > 0) tutorTotalCell.classList.add('text-red-500');
                    else tutorTotalCell.classList.remove('text-red-500');
                }
            });
        }

        // æ¸²æŸ“è¡¨å°¾çµæ§‹
        function renderFooterStructure() {
            tableFooter.innerHTML = ''; // æ¸…ç©ºèˆŠè¡¨å°¾

            // ç¬¬ä¸€è¡Œï¼šå°å¹«æ‰‹æ¨™æ³¨æ¬¡æ•¸
            const assistantFooterRow = tableFooter.insertRow();
            const assistantLabelCell = assistantFooterRow.insertCell();
            assistantLabelCell.textContent = 'å°å¹«æ‰‹æ¨™æ³¨æ¬¡æ•¸ï¼š'; 
            assistantLabelCell.colSpan = 3; // æ—¥æœŸ, ç¯€æ¬¡, ç§‘ç›®
            assistantLabelCell.classList.add('text-right', 'pr-4', 'sticky-col', 'sticky-col-date', 'bg-gray-100', 'align-middle');

            students.forEach(student => {
                const totalCell = assistantFooterRow.insertCell();
                totalCell.id = `assistant-total-cell-${student.id}`; 
                totalCell.textContent = '0';
                totalCell.classList.add('align-middle', 'bg-gray-100');
            });

            // ç¬¬äºŒè¡Œï¼šå°å¸«æ¨™è¨˜æ¬¡æ•¸
            const tutorFooterRow = tableFooter.insertRow();
            const tutorLabelCell = tutorFooterRow.insertCell();
            tutorLabelCell.textContent = 'å°å¸«æ¨™è¨˜æ¬¡æ•¸ï¼š'; 
            tutorLabelCell.colSpan = 3; // æ—¥æœŸ, ç¯€æ¬¡, ç§‘ç›®
            tutorLabelCell.classList.add('text-right', 'pr-4', 'sticky-col', 'sticky-col-date', 'bg-gray-100', 'align-middle');

            students.forEach(student => {
                const totalCell = tutorFooterRow.insertCell();
                totalCell.id = `tutor-total-cell-${student.id}`; 
                totalCell.textContent = '0';
                totalCell.classList.add('align-middle', 'bg-gray-100');
            });

            // ç¬¬ä¸‰è¡Œï¼šæŸ¥çœ‹è©³ç´°è¨˜éŒ„çš„é€£çµæç¤º
            const summaryLinkRow = tableFooter.insertRow();
            const summaryLinkCell = summaryLinkRow.insertCell();
            summaryLinkCell.colSpan = 3 + students.length; // æ©«è·¨æ‰€æœ‰æ¬„ä½
            summaryLinkCell.classList.add('text-center', 'py-3', 'summary-link'); // ç½®ä¸­ä¸¦å¢åŠ ä¸Šä¸‹é–“è·
            const summarySpan = document.createElement('span');
            summarySpan.textContent = 'æŸ¥çœ‹è©²é€±å­¸ç”Ÿæ› èª²è©³ç´°è¨˜éŒ„';
            summarySpan.onclick = function() {
                // å¯¦éš›çš„è©³ç´°è¨˜éŒ„é é¢æˆ–å½ˆå‡ºè¦–çª—åŠŸèƒ½å¯ä»¥åœ¨æ­¤è™•å¯¦ç¾
                alert('æ­¤åŠŸèƒ½å°‡é¡¯ç¤ºè©²é€±æ‰€æœ‰å­¸ç”Ÿçš„è©³ç´°æ› èª²æ¨™è¨˜ï¼ˆä¾‹å¦‚ï¼šç”±èª°åœ¨å“ªä¸€ç¯€èª²æ¨™è¨˜ï¼‰ã€‚ç›®å‰ç‚ºæ¦‚å¿µæ€§æç¤ºã€‚');
            };
            summaryLinkCell.appendChild(summarySpan);
        }

        // ç•¶é€±ä¸€æ—¥æœŸæ”¹è®Šæ™‚çš„äº‹ä»¶è™•ç†
        weekStartInput.addEventListener('change', (event) => {
            const selectedDate = new Date(event.target.value);
            // ç¢ºä¿é¸æ“‡çš„æ˜¯é€±ä¸€ï¼Œå¦‚æœä¸æ˜¯ï¼Œè‡ªå‹•èª¿æ•´åˆ°è©²é€±çš„é€±ä¸€
            if (selectedDate.getDay() !== 1) { 
                alert('æ—¥æœŸå·²è‡ªå‹•èª¿æ•´ç‚ºæ‰€é¸é€±çš„é€±ä¸€ã€‚');
                const dayOfWeek = selectedDate.getDay(); // 0 for Sunday, 1 for Monday...
                const diffToMonday = selectedDate.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); 
                const monday = new Date(selectedDate.setDate(diffToMonday));
                weekStartInput.valueAsDate = monday; // æ›´æ–°è¼¸å…¥æ¡†çš„å€¼
                renderTable(monday);
            } else {
                renderTable(selectedDate);
            }
        });

        // ç•¶å¡«è¡¨äººè§’è‰²æ”¹è®Šæ™‚ï¼Œé‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥é¡¯ç¤ºè©²è§’è‰²çš„æ¨™è¨˜ï¼Œä¸¦æ›´æ–°ç¸½è¨ˆ
        formFillerSelect.addEventListener('change', () => {
            const selectedDate = new Date(weekStartInput.value);
            renderTable(selectedDate); // renderTable å…§éƒ¨æœƒè®€å– formFillerSelect.value ä¾†æ±ºå®šé¡¯ç¤ºå“ªå€‹è§’è‰²çš„æ¨™è¨˜
        });

        // DOMContentLoaded äº‹ä»¶ï¼Œç¢ºä¿é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initializeDate();
             if (!weekStartInput.value) { // ç¢ºä¿åœ¨æ²’æœ‰é è¨­æ—¥æœŸæ™‚é¡¯ç¤ºæç¤º
                tableContainer.classList.add('hidden');
                noDataMessage.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
